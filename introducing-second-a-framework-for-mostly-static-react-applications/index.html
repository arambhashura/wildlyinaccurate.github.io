<!doctype html> <html lang="en"> <head> <meta charset="utf-8"> <meta http-equiv="x-ua-compatible" content="ie=edge"> <meta name="viewport" content="width=device-width,initial-scale=1"> <meta name="theme-color" content="#8e44ad"> <title>Introducing Second: a framework for mostly-static React applications | Wildly Inaccurate</title> <meta name="description" content="TL;DR  Second is a framework for building React applications where the data is fetched on the server and most of the components do not change after the first render.  Components can declare their data dependencies in a way similar to Relay.  Every..."> <style>img,table{max-width:100%}ol,p,pre,table,ul{margin-bottom:1rem}a,table{background-color:transparent}ol,p,pre,ul{margin-top:0}#carbonads,article,footer,header,nav,section{display:block}.w-100,.wrap,table{width:100%}a:active,a:hover{outline-width:0}html{box-sizing:border-box;font-family:sans-serif;line-height:1.15;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%;-ms-overflow-style:scrollbar;-webkit-tap-highlight-color:transparent}*,::after,::before{box-sizing:inherit}@-ms-viewport{width:device-width}body{margin:0;font-family:serif;font-size:1.32rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff}ul ul{margin-bottom:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:80%}a{color:#8e44ad;text-decoration:none;-webkit-text-decoration-skip:objects}a:hover{color:#612e76;text-decoration:underline}code,pre{font-family:monospace,monospace}pre{overflow:auto;padding:1rem}img{vertical-align:middle;border-style:none;height:auto}svg:not(:root){overflow:hidden}a,input{touch-action:manipulation}table{border-collapse:collapse}input{margin:0;font-family:inherit;font-size:inherit;line-height:inherit;overflow:visible}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}.btn,h1,h2,h3,h4,h5{font-family:sans-serif}h1,h2,h3,h4,h5{margin-top:0;margin-bottom:.33rem;font-weight:500;line-height:1.5;color:inherit}h1{font-size:2.5rem}h2{font-size:2rem}h3{font-size:1.75rem}h4{font-size:1.5rem}h5{font-size:1.25rem}small{font-weight:400}table td{padding:.75rem;vertical-align:top}table,table td{border:1px solid #e9ecef}#carbonads{margin:1rem auto;max-width:200px}.mb-4,.my-4{margin-bottom:1.5rem}.carbon-poweredby,.carbon-text{color:#495057;display:block;margin-top:.5rem}.btn,.d-ib{display:inline-block}.my-4,h1,h2,h3{margin-top:1.5rem}blockquote{border-left:5px solid #ddd;padding:1rem 2rem 1px}.btn{background:#8e44ad;color:#fff}.btn:focus,.btn:hover{background:rgba(142,68,173,.8);color:#fff}.btn--inverse{background:rgba(255,255,255,.67);color:#8e44ad}.btn--inverse:focus,.btn--inverse:hover{background:rgba(255,255,255,.4)}code,pre{background:#e9ecef;font-size:90%}code{padding:.3333333333rem .5rem}pre code{padding:0}[class*=language-] pre,[class*=language-] pre code{background:#343a40}footer{border-top:1px solid #495057}.wrap{margin-right:auto;margin-left:auto;padding-right:15px;padding-left:15px}@media (min-width:576px){.wrap{max-width:544px}}@media (min-width:768px){.wrap{max-width:736px}}@media (min-width:960px){.wrap{max-width:928px}}.ls-n{list-style:none}.page-header{color:#fff;min-height:240px;overflow:hidden;position:relative;text-shadow:-1px 0 1px #000}.page-header a{color:#fff}.va-m{vertical-align:middle}.c-gl{color:#495057}.z-1{z-index:1}.z--1{z-index:-1}.f-r{float:right}.pos-a{position:absolute}.b-0{bottom:0}.h-100{height:100%}.h-4{height:1.5rem}.w-4{width:1.5rem}.mw-n{max-width:none}.mt-5{margin-top:3rem}.p-0{padding:0}.p-2{padding:.5rem}.pt-2{padding-top:.5rem}.p-3{padding:1rem}.pb-3{padding-bottom:1rem}.pt-4{padding-top:1.5rem}.pt-5{padding-top:3rem}@media (min-width:576px){.h-sm-a{height:auto}.p-sm-3{padding:1rem}}@media (min-width:960px){.pt-lg-4{padding-top:1.5rem}}.ta-c{text-align:center}</style> <link rel="manifest" href="/manifest.json"> <link rel="canonical" href="https://wildlyinaccurate.com/introducing-second-a-framework-for-mostly-static-react-applications"> <link rel="alternate" type="application/atom+xml" title="Wildly Inaccurate" href="https://wildlyinaccurate.com/feed.xml"> <style>.hll{background-color:#49483e}.c{color:#75715e}.err{color:#960050;background-color:#1e0010}.k{color:#66d9ef}.l{color:#ae81ff}.n{color:#f8f8f2}.o{color:#f92672}.p{color:#f8f8f2}.c1,.cm,.cp,.cs{color:#75715e}.ge{font-style:italic}.gs{font-weight:700}.kc,.kd{color:#66d9ef}.kn{color:#f92672}.kp,.kr,.kt{color:#66d9ef}.ld{color:#e6db74}.m{color:#ae81ff}.s{color:#e6db74}.na{color:#a6e22e}.nb{color:#f8f8f2}.nc{color:#a6e22e}.no{color:#66d9ef}.nd{color:#a6e22e}.ni{color:#f8f8f2}.ne,.nf{color:#a6e22e}.nl,.nn{color:#f8f8f2}.nx{color:#a6e22e}.py{color:#f8f8f2}.nt{color:#f92672}.nv{color:#f8f8f2}.ow{color:#f92672}.w{color:#f8f8f2}.mf,.mh,.mi,.mo{color:#ae81ff}.s2,.sb,.sc,.sd{color:#e6db74}.se{color:#ae81ff}.s1,.sh,.si,.sr,.ss,.sx{color:#e6db74}.bp,.vc,.vg,.vi{color:#f8f8f2}.il{color:#ae81ff}.gu{color:#75715e}.gd{color:#f92672}.gi{color:#a6e22e}</style> </head> <body> <nav class="pos-a w-100 z-1"> <div class="wrap"> <a class="btn p-2 p-sm-3" href="https://wildlyinaccurate.com">Wildly Inaccurate</a> <div class="f-r"> <a class="btn btn--inverse p-2 p-sm-3" href="/about/">About</a> <a class="btn btn--inverse p-2 p-sm-3" href="/projects/">Projects</a> <a class="btn btn--inverse p-2 p-sm-3" href="/search/">Search</a> </div> </div> </nav> <header class="page-header mb-4"> <img class="pos-a b-0 h-100 mw-n h-sm-a z--1" src="/assets/dfi.jpg" srcset="/assets/r/345/dfi.jpg 345w, /assets/r/384/dfi.jpg 384w, /assets/r/514/dfi.jpg 514w, /assets/r/545/dfi.jpg 545w, /assets/r/706/dfi.jpg 706w, /assets/r/898/dfi.jpg 898w, /assets/r/1280/dfi.jpg 1280w, /assets/r/1366/dfi.jpg 1366w, /assets/r/1440/dfi.jpg 1440w, /assets/r/1680/dfi.jpg 1680w, /assets/dfi.jpg 2600w"> <div class="wrap mt-5 pt-2"> <h1 class="mt-5">Introducing Second: a framework for mostly-static React applications</h1> <p class="pt-2 pt-lg-4"> Aug 5, 2017 &#x2022; posted in [ <a href="/category/Web Development/">Web Development</a>, <a href="/category/React/">React</a> ] </p> </div> </header> <article class="wrap"> <h2 id="tldr">TL;DR</h2> <ul> <li><a href="https://github.com/wildlyinaccurate/second">Second</a> is a framework for building React applications where the data is fetched on the server and most of the components do not change after the first render.</li> <li>Components can declare their data dependencies in a way similar to <a href="https://facebook.github.io/relay/">Relay</a>.</li> <li>Everything is rendered only on the server by default; components can opt-in to client-side rendering using the component dehydrator.</li> <li>Second works with any React-like library including <a href="https://preactjs.com/">Preact</a>.</li> </ul> <h2 id="why-build-this-framework">Why build this framework?</h2> <p>While using React to build the <a href="/introducing-a-faster-bbc-news-front-page/">BBC News front page</a> and several other mostly-static applications, a common theme emerged: only a small number of components on these pages require client-side JavaScript to function. Bundling the entire page to render on the client does not provide an optimal experience &#x2014; especially for users on low-powered devices or low-speed connections. Instead, selectively bundling components enables development teams to take advantage of React&#x2019;s event system and stateful components while reducing bundle size and minimizing CPU overhead for client-side rendering.</p> <p>Second is not a large or complex framework. It is the result of combining several simple and well-tested techniques&#x2014;</p> <ul> <li>Server-side rendering</li> <li>Container components for declarative data requirements</li> <li>Selective client-side rendering</li> </ul> <p>&#x2014;and combining them into a single package that can be easily reused across multiple applications.<!--more--></p> <h2 id="how-does-it-work">How does it work?</h2> <h3 id="server-side-rendering">Server-side rendering</h3> <p>At its simplest, Second is just a wrapper around server-side rendering:</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">VDom</span> <span class="k">from</span> <span class="s1">&apos;react&apos;</span>
<span class="k">import</span> <span class="nx">VDomServer</span> <span class="k">from</span> <span class="s1">&apos;react-dom/server&apos;</span>
<span class="k">import</span> <span class="nx">second</span> <span class="k">from</span> <span class="s1">&apos;second&apos;</span>
<span class="k">import</span> <span class="nx">MyComponent</span> <span class="k">from</span> <span class="s1">&apos;./components/my-component&apos;</span>

<span class="nx">second</span><span class="p">.</span><span class="nx">init</span><span class="p">({</span> <span class="nx">VDom</span><span class="p">,</span> <span class="nx">VDomServer</span> <span class="p">})</span>

<span class="kd">const</span> <span class="nx">props</span> <span class="o">=</span> <span class="p">{</span>
  <span class="c1">// ...</span>
<span class="p">}</span>

<span class="nx">second</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">MyComponent</span><span class="p">,</span> <span class="nx">props</span><span class="p">).</span><span class="nx">then</span><span class="p">((</span><span class="nx">result</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&apos;Rendered HTML:&apos;</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span>
<span class="p">})</span>
</code></pre></div></div> <h3 id="data-driven-components">Data-driven components</h3> <p>At the heart of Second is <a href="https://github.com/wildlyinaccurate/second/tree/master/packages/second-container">second-container</a>. Inspired by Facebook&#x2019;s <a href="https://facebook.github.io/relay/">Relay</a>, it is a higher-order component that allows components to declare their data requirements. Unlike Relay which works only with GraphQL, second-container works with regular HTTP requests out of the box and supports custom data fetchers as well.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">ComponentWithData</span> <span class="o">=</span> <span class="nx">second</span><span class="p">.</span><span class="nx">createContainer</span><span class="p">(</span><span class="nx">MyComponent</span><span class="p">,</span> <span class="p">{</span>
  <span class="na">data</span><span class="p">:</span> <span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">({</span>
    <span class="c1">// Each key is provided to the wrapped component as a prop</span>
    <span class="na">response</span><span class="p">:</span> <span class="p">{</span>
      <span class="c1">// Use props to dynamically build API endpoints</span>
      <span class="na">uri</span><span class="p">:</span> <span class="s2">`http://api.duckduckgo.com/?q=</span><span class="p">${</span><span class="nx">props</span><span class="p">.</span><span class="nx">query</span><span class="p">}</span><span class="s2">&amp;format=json`</span>
    <span class="p">}</span>
  <span class="p">})</span>
<span class="p">})</span>
</code></pre></div></div> <p>Containers can be used at any level of the render tree, allowing leaf nodes to fetch their own data. For static render trees, this typically scales better than fetching data at the root and passing it as a prop down through the entire tree.</p> <h2 id="partial-opt-in-browser-rendering">Partial, opt-in browser rendering</h2> <p><a href="https://github.com/wildlyinaccurate/second/tree/master/packages/second-dehydrator">second-dehydrator</a> is a higher-order component that serialises (&#x201C;dehydrates&#x201D;) a component&#x2019;s props and renders them into an inline <code class="highlighter-rouge">&lt;script&gt;</code> tag. The component can then be hydrated in the browser with those props, and rendered as a regular client-side React component.</p> <p>Take this &#x201C;top stories&#x201D; BBC News component, for example. It is static except for the live-updating promo in the bottom-right corner.</p> <div class="my-4 ta-c"> <img alt="BBC News top stories component, containing a live-updating promo" src="/assets/bbc-news-top-stories-live-component.png" srcset="/assets/r/345/bbc-news-top-stories-live-component.png 345w, /assets/r/384/bbc-news-top-stories-live-component.png 384w, /assets/r/514/bbc-news-top-stories-live-component.png 514w, /assets/r/545/bbc-news-top-stories-live-component.png 545w, /assets/r/706/bbc-news-top-stories-live-component.png 706w, /assets/r/898/bbc-news-top-stories-live-component.png 898w"> <div class="c-gl"> <small><i>BBC News top stories component, containing a live-updating promo</i></small> </div> </div> <p>This component can be bundled efficiently by dehydrating just the live component:</p> <div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">createDehydrator</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">&apos;second-dehydrator&apos;</span>
<span class="k">import</span> <span class="nx">StaticPromo</span> <span class="k">from</span> <span class="s1">&apos;./components/static-promo&apos;</span>
<span class="k">import</span> <span class="nx">LivePromo</span> <span class="k">from</span> <span class="s1">&apos;./components/live-promo&apos;</span>

<span class="kd">const</span> <span class="nx">dehydrate</span> <span class="o">=</span> <span class="nx">createDehydrator</span><span class="p">(</span><span class="nx">React</span><span class="p">.</span><span class="nx">createElement</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">DehydratedLivePromo</span> <span class="o">=</span> <span class="nx">dehydrate</span><span class="p">(</span><span class="nx">LivePromo</span><span class="p">)</span>

<span class="kd">const</span> <span class="nx">TopStories</span> <span class="o">=</span> <span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="o">=&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">className=</span><span class="s2">&quot;nw-c-top-stories&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nc">StaticPromo</span> <span class="na">item=</span><span class="si">{</span><span class="nx">props</span><span class="p">.</span><span class="nx">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nc">StaticPromo</span> <span class="na">item=</span><span class="si">{</span><span class="nx">props</span><span class="p">.</span><span class="nx">items</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nc">StaticPromo</span> <span class="na">item=</span><span class="si">{</span><span class="nx">props</span><span class="p">.</span><span class="nx">items</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nc">StaticPromo</span> <span class="na">item=</span><span class="si">{</span><span class="nx">props</span><span class="p">.</span><span class="nx">items</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="si">}</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nc">StaticPromo</span> <span class="na">item=</span><span class="si">{</span><span class="nx">props</span><span class="p">.</span><span class="nx">items</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="si">}</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nc">DehydratedLivePromo</span> <span class="na">item=</span><span class="si">{</span><span class="nx">props</span><span class="p">.</span><span class="nx">items</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="si">}</span> <span class="p">/&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></div></div> <p>To hydrate this component in the browser, second-dehydrator takes a component map and a function to call when the component is hydrated. As the hydrator finds dehydrated <code class="highlighter-rouge">LivePromo</code> components and their corresponding props, it passes them to the function where they can be rendered them with React.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">React</span> <span class="k">from</span> <span class="s1">&apos;react&apos;</span>
<span class="k">import</span> <span class="nx">ReactDOM</span> <span class="k">from</span> <span class="s1">&apos;react-dom&apos;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">hydrate</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">&apos;second-dehydrator&apos;</span>

<span class="kd">const</span> <span class="nx">renderComponent</span> <span class="o">=</span> <span class="p">(</span><span class="nx">HydratedComponent</span><span class="p">,</span> <span class="nx">props</span><span class="p">,</span> <span class="nx">containerElement</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">ReactDOM</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span>
    <span class="nx">React</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="nx">HydratedComponent</span><span class="p">,</span> <span class="nx">props</span><span class="p">),</span>
    <span class="nx">containerElement</span>
  <span class="p">)</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">componentMap</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">LivePromo</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="k">import</span><span class="p">(</span><span class="cm">/* webpackMode: &quot;eager&quot; */</span> <span class="s1">&apos;./components/live-promo&apos;</span><span class="p">)</span>
<span class="p">}</span>

<span class="nx">hydrate</span><span class="p">(</span><span class="nx">renderComponent</span><span class="p">,</span> <span class="nx">componentMap</span><span class="p">)</span>
</code></pre></div></div> </article> <div class="wrap pt-4"> <p> <i>Have any questions or comments? Feel free to reach out on Twitter: <a href="https://twitter.com/Joseph_Wynn">@Joseph_Wynn</a></i> </p> <small> <blockquote> <p>This post was published on <b>5 August, 2017</b> and last updated on <b>5 August, 2017</b>. It was posted in [<a href="/category/Web Development/">Web Development</a>, <a href="/category/React/">React</a>] and tagged with [<a href="/tag/react/">react</a>, <a href="/tag/preact/">preact</a>, <a href="/tag/static/">static</a>, <a href="/tag/server-rendering/">server-rendering</a>] </p> </blockquote> </small> </div> <footer class="wrap mt-5 pt-4"> <ul class="ls-n f-r"> <li> <a href="https://github.com/wildlyinaccurate"> <span class="d-ib va-m w-4 h-4"> <svg viewbox="0 0 16 16"> <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/> </svg> </span> <span>wildlyinaccurate</span> </a> </li> <li> <a href="https://twitter.com/joseph_wynn"> <span class="d-ib va-m w-4 h-4"> <svg viewbox="0 0 16 16"> <path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
                        c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/> </svg> </span> <span>joseph_wynn</span> </a> </li> </ul> <small> <i>A collection of guides &amp; opinions about programming and the state of the web, from a developer at BBC News. </i> </small> </footer> <script defer="defer"> if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('/service-worker.js');
            } </script> <script defer="defer"> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-20744182-3', { siteSpeedSampleRate: 100 });
            ga('send', 'pageview'); </script> <script defer="defer"> (function() {
                var s, p, n, a;

                s = document.createElement('script');
                s.async = 1;
                s.src = '//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=wildlyinaccuratecom';
                s.id = '_carbonads_js';

                p = document.createElement('small');
                p.className = 'ta-c';
                p.appendChild(s);

                n = document.querySelector('article > p:nth-of-type(3)');

                if (n) {
                    n.parentNode.insertBefore(p, n.nextSibling);
                } else {
                    n = document.getElementsByTagName('article')[0];
                    n.parentNode.insertBefore(p, n.nextSibling);
                }
            })(); </script> </body> </html> 